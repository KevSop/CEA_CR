<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="MenuSendManageMap"  xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
	<alias>
		<typeAlias alias="MenuSendManage" assembly="DataAccess.dll" type="DataAccess.Domain.MenuSendManage" />
	</alias>
	<resultMaps>
		<resultMap id="MenuSendManageResult" class="MenuSendManage">
			<result property="Id" column="ID" type="long" dbType="long"/>
			<result property="SendNo" column="SendNo" type="string" dbType="varchar"/>
			<result property="ConsumerNo" column="ConsumerNo" type="string" dbType="varchar"/>
			<result property="OrdersNo" column="OrdersNo" type="string" dbType="varchar"/>
			<result property="ReachTime" column="ReachTime" type="string" dbType="varchar"/>
			<result property="Taste" column="Taste" type="string" dbType="varchar"/>
			<result property="MsmSendStatus" column="msm_SendStatus" type="string" dbType="varchar"/>
			<result property="SendUser" column="SendUser" type="string" dbType="varchar"/>
			<result property="CreateUser" column="CreateUser" type="string" dbType="varchar"/>
			<result property="CreateTime" column="CreateTime" type="DateTime" dbType="DateTime"/>
			<result property="UpdUser" column="UpdUser" type="string" dbType="varchar"/>
			<result property="UpdTime" column="UpdTime" type="DateTime" dbType="DateTime"/>
			<result property="Reason" column="Reason" type="string" dbType="varchar"/>
			<result property="ConsumerPhone" column="ConsumerPhone" type="string" dbType="varchar"/>
			<result property="Province" column="Province" type="string" dbType="varchar"/>
			<result property="City" column="City" type="string" dbType="varchar"/>
			<result property="County" column="County" type="string" dbType="varchar"/>
			<result property="Street" column="Street" type="string" dbType="varchar"/>
			<result property="Remark" column="Remark" type="string" dbType="varchar"/>
		</resultMap>
	</resultMaps>
  <parameterMaps>
    <parameterMap id="MyMenuSendManage" class="Hashtable">

      <parameter property="startDate" />
      <parameter property="endDate" />

    </parameterMap>
  </parameterMaps>
	<statements>
		<select id="SelectMenuSendManage" parameterClass="string" resultClass="MenuSendManage">
			SELECT ID AS Id,SendNo AS SendNo,ConsumerNo AS ConsumerNo,OrdersNo AS OrdersNo,ReachTime AS ReachTime,Taste AS Taste,msm_SendStatus AS MsmSendStatus,SendUser AS SendUser,
			CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime,Reason AS Reason,ConsumerPhone AS ConsumerPhone,Province AS Province,City AS City,
			County AS County,Street AS Street,Remark AS Remark
			FROM MenuSendManage
			<dynamic prepend="WHERE">
				<isParameterPresent>
					ID = #value#
				</isParameterPresent>
			</dynamic>
		</select>
		<select id="SelectMenuSendManageList" parameterClass="Hashtable" resultClass="Hashtable">
			select send.SendNo,send.OrdersNo,send.ConsumerNo,send.msm_SendStatus,send.ReachTime,send.ConsumerPhone,
			comsumer.ConsumerName,comsumer.Phone,send.CreateTime
			from MenuSendManage send
			Left join ComsumerManage comsumer
			on send.ConsumerNo=comsumer.ConsumerNo
			<dynamic prepend=" where ">
				<isNotEmpty prepend="and" property="sendno">
					send.SendNo=#sendno#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="sendstatus">
					send.msm_SendStatus=#sendstatus#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="phone">
					send.ConsumerPhone=#phone#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="startDate">
					send.CreateTime>= #startDate#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="endDate">
					<![CDATA[ send.CreateTime <= #endDate# ]]>
				</isNotEmpty>
			</dynamic>
		</select>
		<insert id="InsertMenuSendManage" parameterClass="MenuSendManage">
			INSERT INTO MenuSendManage
			(SendNo,ConsumerNo,OrdersNo,ReachTime,Taste,msm_SendStatus,SendUser,CreateUser,CreateTime,UpdUser,UpdTime,Reason,ConsumerPhone,Province,City,County,Street,Remark)
			VALUES(#SendNo#,#ConsumerNo#,#OrdersNo#,#ReachTime#,#Taste#,#MsmSendStatus#,#SendUser#,#CreateUser#,#CreateTime#,#UpdUser#,#UpdTime#,#Reason#,#ConsumerPhone#,#Province#,#City#,#County#,#Street#,#Remark#)
			<selectKey resultClass="long" type="post" property="Id">
				SELECT  LAST_INSERT_ROWID() as value
			</selectKey>
		</insert>
		<update id="UpdateMenuSendManage" parameterClass="MenuSendManage">
			UPDATE MenuSendManage
			SET SendNo=#SendNo#,ConsumerNo=#ConsumerNo#,OrdersNo=#OrdersNo#,ReachTime=#ReachTime#,Taste=#Taste#,msm_SendStatus=#MsmSendStatus#,SendUser=#SendUser#,CreateUser=#CreateUser#,CreateTime=#CreateTime#,UpdUser=#UpdUser#,UpdTime=#UpdTime#,Reason=#Reason#,ConsumerPhone=#ConsumerPhone#,Province=#Province#,City=#City#,County=#County#,Street=#Street#,Remark=#Remark#
			WHERE ID = #Id#
		</update>
		<update id="UpdateMenuSendManageStatus" parameterClass="MenuSendManage">
			UPDATE MenuSendManage
			SET msm_SendStatus=#MsmSendStatus#
			WHERE SendNo =#SendNo#
		</update>
		<update id="UpdateMenuSendManageReason" parameterClass="MenuSendManage">
			UPDATE MenuSendManage
			SET  Reason=#Reason#
			WHERE SendNo =#SendNo#
		</update>
		<delete id="DeleteMenuSendManage" parameterClass="string">
			DELETE FROM MenuSendManage
			WHERE ID = #value#
		</delete>
    <delete id="DeleteMenuSendManagePay" parameterMap="MyMenuSendManage">
      DELETE FROM MenuSendManage WHERE OrdersNo IN(SELECT OrdersNo FROM PayManage
      <dynamic prepend=" where ">
        <isNotEmpty prepend="and" property="startDate">
          OwnerTime>= #startDate#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="endDate">
          <![CDATA[ OwnerTime <= #endDate# )]]>
        </isNotEmpty>
      </dynamic>
    </delete>
    <delete id="DeleteMenuSendManageOwner" parameterMap="MyMenuSendManage">
      DELETE FROM MenuSendManage 
      <dynamic prepend=" where ">
      <isNotEmpty prepend="and" property="startDate">
        CreateTime>= #startDate#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="endDate">
        <![CDATA[ CreateTime <= #endDate# ]]>
      </isNotEmpty>
      and OrdersNo not in(Select OrdersNo from PayManage)
    </dynamic>
    </delete>
	</statements>
</sqlMap>
