<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="PayManageMap"   xmlns="http://ibatis.apache.org/mapping"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
  <alias>
    <typeAlias alias="PayManage" assembly="DataAccess.dll" type="DataAccess.Domain.PayManage" />
  </alias>
  <resultMaps>
    <resultMap id="PayManageResult" class="PayManage">
      <result property="Id" column="ID" type="long" dbType="long"/>
      <result property="PayNo" column="PayNo" type="string" dbType="varchar"/>
      <result property="PosTransNo" column="PosTransNo" type="string" dbType="varchar"/>
      <result property="OrdersNo" column="OrdersNo" type="string" dbType="varchar"/>
      <result property="PayDetailNo" column="PayDetailNo" type="string" dbType="varchar"/>
      <result property="PayType" column="PayType" type="long" dbType="long"/>
      <result property="PayMoney" column="PayMoney" type="single" dbType="Real"/>
      <result property="PayWay" column="PayWay" type="string" dbType="varchar"/>
      <result property="Status" column="Status" type="long" dbType="long"/>
      <result property="PayTime" column="PayTime" type="DateTime" dbType="DateTime"/>
      <result property="IsFoot" column="IsFoot" type="long" dbType="long"/>
      <result property="FootTime" column="FootTime" type="DateTime" dbType="DateTime"/>
      <result property="OwnerTime" column="OwnerTime" type="DateTime" dbType="DateTime"/>
      <result property="CreateUser" column="CreateUser" type="string" dbType="varchar"/>
      <result property="CreateTime" column="CreateTime" type="DateTime" dbType="DateTime"/>
      <result property="UpdUser" column="UpdUser" type="string" dbType="varchar"/>
      <result property="UpdTime" column="UpdTime" type="DateTime" dbType="DateTime"/>
    </resultMap>
  </resultMaps>
  <parameterMaps>
    <parameterMap id="MyPayManage" class="Hashtable">

      <parameter property="startDate" />
      <parameter property="endDate" />

    </parameterMap>
  </parameterMaps>

  <statements>

    <select id="SelectPayManageByOrdersNo" parameterClass="string" resultClass="PayManage">
      SELECT ID AS Id,PayNo AS PayNo,PosTransNo AS PosTransNo,OrdersNo AS OrdersNo,PayDetailNo AS PayDetailNo,PayType AS PayType,PayMoney AS PayMoney,PayWay AS PayWay,Status AS Status,PayTime AS PayTime,IsFoot AS IsFoot,FootTime AS FootTime,OwnerTime AS OwnerTime,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM PayManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          OrdersNo = #value# and Status=1
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectPayManageByOrdersNo1" parameterClass="string" resultClass="PayManage">
      SELECT ID AS Id,PayNo AS PayNo,PosTransNo AS PosTransNo,OrdersNo AS OrdersNo,PayDetailNo AS PayDetailNo,PayType AS PayType,PayMoney AS PayMoney,PayWay AS PayWay,Status AS Status,PayTime AS PayTime,IsFoot AS IsFoot,FootTime AS FootTime,OwnerTime AS OwnerTime,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM PayManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          OrdersNo = #value# and Status=1 and PayDetailNo ISNULL
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectPayManageByOrdersNo3" parameterClass="string" resultClass="float">
      SELECT sum(PayMoney) from PayManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          OrdersNo = #value# and Status=1 and PayDetailNo ISNULL
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectPayManageByOrdersNo2" parameterClass="string" resultClass="PayManage">
      SELECT ID AS Id,PayNo AS PayNo,PosTransNo AS PosTransNo,OrdersNo AS OrdersNo,PayDetailNo AS PayDetailNo,PayType AS PayType,PayMoney AS PayMoney,PayWay AS PayWay,Status AS Status,PayTime AS PayTime,IsFoot AS IsFoot,FootTime AS FootTime,OwnerTime AS OwnerTime,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM PayManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          OrdersNo = #value# and Status=1
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectPayManage" parameterClass="string" resultClass="PayManage">
      SELECT ID AS Id,PayNo AS PayNo,PosTransNo AS PosTransNo,OrdersNo AS OrdersNo,PayDetailNo AS PayDetailNo,PayType AS PayType,PayMoney AS PayMoney,PayWay AS PayWay,Status AS Status,PayTime AS PayTime,IsFoot AS IsFoot,FootTime AS FootTime,OwnerTime AS OwnerTime,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM PayManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectPayManageOrder" parameterClass="string" resultClass="PayManage">
      SELECT ID AS Id,PayNo AS PayNo,PosTransNo AS PosTransNo,OrdersNo AS OrdersNo,PayDetailNo AS PayDetailNo,PayType AS PayType,PayMoney AS PayMoney,PayWay AS PayWay,Status AS Status,PayTime AS PayTime,IsFoot AS IsFoot,FootTime AS FootTime,OwnerTime AS OwnerTime,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM PayManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          PayWay = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <insert id="InsertPayManage" parameterClass="PayManage">
      INSERT INTO PayManage
      (PayNo,PosTransNo,OrdersNo,PayDetailNo,PayType,PayMoney,PayWay,Status,PayTime,IsFoot,FootTime,OwnerTime,CreateUser,CreateTime,UpdUser,UpdTime)
      VALUES(#PayNo#,#PosTransNo#,#OrdersNo#,#PayDetailNo#,#PayType#,#PayMoney#,#PayWay#,#Status#,#PayTime#,#IsFoot#,#FootTime#,#OwnerTime#,#CreateUser#,#CreateTime#,#UpdUser#,#UpdTime#)
      <selectKey resultClass="long" type="post" property="Id">
        SELECT LAST_INSERT_ROWID() as value
      </selectKey>
    </insert>
    <update id="UpdatePayManage" parameterClass="PayManage">
      UPDATE PayManage
      SET PayNo=#PayNo#,PosTransNo=#PosTransNo#,OrdersNo=#OrdersNo#,PayDetailNo=#PayDetailNo#,PayType=#PayType#,PayMoney=#PayMoney#,PayWay=#PayWay#,Status=#Status#,PayTime=#PayTime#,IsFoot=#IsFoot#,FootTime=#FootTime#,OwnerTime=#OwnerTime#,CreateUser=#CreateUser#,CreateTime=#CreateTime#,UpdUser=#UpdUser#,UpdTime=#UpdTime#
      WHERE ID = #Id#
    </update>
    <update id="UpdatePayManage2" parameterClass="PayManage">
      UPDATE PayManage
      SET PosTransNo=#PosTransNo#,Status=#Status#,UpdUser=#UpdUser#,UpdTime=#UpdTime#
      WHERE PayNo=#PayNo#
    </update>

    <update id="UpdatePayManageDay" parameterClass="Hashtable">
      UPDATE PayManage
      SET IsFoot=#IsFoot#,FootTime=#FootTime#,OwnerTime=#OwnerTime#
      WHERE PayTime between  #PayTimeStartTime# and #PayTimeEndTime#
    </update>
    <delete id="DeletePayManage" parameterClass="string">
      DELETE FROM PayManage
      WHERE ID = #value#
    </delete>
    <delete id="DeletePayManage1" parameterMap="MyPayManage">
      DELETE FROM PayManage
      <dynamic prepend=" where ">
        <isNotEmpty prepend="and" property="startDate">
          FootTime>= #startDate#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="endDate">
          <![CDATA[ FootTime <= #endDate# ]]>
        </isNotEmpty>

      </dynamic>
    </delete>
    <delete id="DeletePayManage2" parameterClass="string">
      delete from PayManage
      WHERE OrdersNo=#value#
    </delete>
  </statements>
</sqlMap>
