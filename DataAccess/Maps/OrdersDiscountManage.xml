<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="OrdersDiscountManageMap"   xmlns="http://ibatis.apache.org/mapping"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
  <alias>
    <typeAlias alias="OrdersDiscountManage" assembly="DataAccess.dll" type="DataAccess.Domain.OrdersDiscountManage" />
  </alias>
  <resultMaps>
    <resultMap id="OrdersDiscountManageResult" class="OrdersDiscountManage">
      <result property="Id" column="ID" type="long" dbType="long"/>
      <result property="DiscountType" column="DiscountType" type="string" dbType="varchar"/>
      <result property="DiscountStyle" column="DiscountStyle" type="string" dbType="varchar"/>
      <result property="OrdersNo" column="OrdersNo" type="string" dbType="varchar"/>
      <result property="MenuNo" column="MenuNo" type="string" dbType="varchar"/>
      <result property="DiscountRuleNo" column="DiscountRuleNo" type="string" dbType="varchar"/>
      <result property="DiscountPercent" column="DiscountPercent" type="single" dbType="Real"/>
      <result property="DiscountMoney" column="DiscountMoney" type="single" dbType="Real"/>
      <result property="CreateUser" column="CreateUser" type="string" dbType="varchar"/>
      <result property="CreateTime" column="CreateTime" type="DateTime" dbType="DateTime"/>
      <result property="UpdUser" column="UpdUser" type="string" dbType="varchar"/>
      <result property="UpdTime" column="UpdTime" type="DateTime" dbType="DateTime"/>
    </resultMap>
  </resultMaps>
  <parameterMaps>
    <parameterMap id="MyOrdersDiscountManage" class="Hashtable">

      <parameter property="startDate" />
      <parameter property="endDate" />

    </parameterMap>
  </parameterMaps>
  <statements>

    <select id="SelectOrdersDiscountManage" parameterClass="string" resultClass="OrdersDiscountManage">
      SELECT ID AS Id,DiscountType AS DiscountType,DiscountStyle AS DiscountStyle,OrdersNo AS OrdersNo,MenuNo AS MenuNo,DiscountRuleNo AS DiscountRuleNo,DiscountPercent AS DiscountPercent,DiscountMoney AS DiscountMoney,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM OrdersDiscountManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectOrdersDiscountManage2" parameterClass="string" resultClass="OrdersDiscountManage">
      SELECT ID AS Id,DiscountType AS DiscountType,DiscountStyle AS DiscountStyle,OrdersNo AS OrdersNo,MenuNo AS MenuNo,DiscountRuleNo AS DiscountRuleNo,DiscountPercent AS DiscountPercent,DiscountMoney AS DiscountMoney,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM OrdersDiscountManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          OrdersNo = #value#
        </isParameterPresent>
      </dynamic>
    </select>
<!--查询折扣类型是否运用于订单折�? kzheng-->
    <select id="SelectOrdersDiscountManageCount" parameterClass="string">
      select count(0) FROM OrdersDiscountManage
      <dynamic prepend="WHERE">
        <isParameterPresent>
          DiscountType = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    
   
    <insert id="InsertOrdersDiscountManage" parameterClass="OrdersDiscountManage">
      INSERT INTO OrdersDiscountManage
      (DiscountType,DiscountStyle,OrdersNo,MenuNo,DiscountRuleNo,DiscountPercent,DiscountMoney,CreateUser,CreateTime,UpdUser,UpdTime)
      VALUES(#DiscountType#,#DiscountStyle#,#OrdersNo#,#MenuNo#,#DiscountRuleNo#,#DiscountPercent#,#DiscountMoney#,#CreateUser#,#CreateTime#,#UpdUser#,#UpdTime#)
      <selectKey resultClass="long" type="post" property="Id">
        SELECT LAST_INSERT_ROWID() as value
      </selectKey>
    </insert>
    <update id="UpdateOrdersDiscountManage" parameterClass="OrdersDiscountManage">
      UPDATE OrdersDiscountManage
      SET DiscountType=#DiscountType#,DiscountStyle=#DiscountStyle#,OrdersNo=#OrdersNo#,MenuNo=#MenuNo#,DiscountRuleNo=#DiscountRuleNo#,DiscountPercent=#DiscountPercent#,DiscountMoney=#DiscountMoney#,CreateUser=#CreateUser#,CreateTime=#CreateTime#,UpdUser=#UpdUser#,UpdTime=#UpdTime#
      WHERE ID = #Id#
    </update>
    <delete id="DeleteOrdersDiscountManage" parameterClass="string">
      DELETE FROM OrdersDiscountManage
      WHERE ID = #value#
    </delete>
    <delete id="DeleteOrdersDiscountManage2" parameterClass="string">
      DELETE FROM OrdersDiscountManage
      WHERE OrdersNo = #value#
    </delete>
    <delete id="DeleteOrdersDiscountManagePay" parameterMap="MyOrdersDiscountManage">
      DELETE FROM OrdersDiscountManage WHERE OrdersNo IN(SELECT OrdersNo FROM PayManage
      <dynamic prepend=" where ">
        <isNotEmpty prepend="and" property="startDate">
          OwnerTime>= #startDate#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="endDate">
          <![CDATA[ OwnerTime <= #endDate# )]]>
        </isNotEmpty>
      </dynamic>
    </delete>
    <delete id="DeleteOrdersDiscountManageOwner" parameterMap="MyOrdersDiscountManage">
      DELETE FROM OrdersDiscountManage 
      <dynamic prepend=" where ">
      <isNotEmpty prepend="and" property="startDate">
        CreateTime>= #startDate#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="endDate">
        <![CDATA[ CreateTime <= #endDate# ]]>
      </isNotEmpty>
      and OrdersNo not in(Select OrdersNo from PayManage)
    </dynamic>
    </delete>
  </statements>
</sqlMap>
