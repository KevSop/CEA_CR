<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="SeatManageMap"   xmlns="http://ibatis.apache.org/mapping"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
  <alias>
    <typeAlias alias="SeatManage" assembly="DataAccess.dll" type="DataAccess.Domain.SeatManage" />
  </alias>
  <resultMaps>
    <resultMap id="SeatManageResult" class="SeatManage">
      <result property="Id" column="ID" type="long" dbType="long"/>
      <result property="Number" column="Number" type="string" dbType="varchar"/>
      <result property="HelpRememberCode" column="HelpRememberCode" type="string" dbType="varchar"/>
      <result property="AreaCode" column="AreaCode" type="string" dbType="varchar"/>
      <result property="SeatCount" column="SeatCount" type="string" dbType="varchar"/>
      <result property="PrivateRoomCode" column="PrivateRoomCode" type="string" dbType="varchar"/>
      <result property="IsAcceptOrder" column="IsAcceptOrder" type="long" dbType="long"/>
      <result property="Status" column="Status" type="string" dbType="varchar"/>
      <result property="FloorNumber" column="FloorNumber" type="long" dbType="long"/>
      <result property="SeatTypeCode" column="SeatTypeCode" type="string" dbType="varchar"/>
      <result property="MinConsumeMoney" column="MinConsumeMoney" type="single" dbType="Real"/>
      <result property="IsValidate" column="IsValidate" type="long" dbType="long"/>
      <result property="CreateUser" column="CreateUser" type="string" dbType="varchar"/>
      <result property="CreateTime" column="CreateTime" type="DateTime" dbType="DateTime"/>
      <result property="UpdUser" column="UpdUser" type="string" dbType="varchar"/>
      <result property="UpdTime" column="UpdTime" type="DateTime" dbType="DateTime"/>
    </resultMap>
  </resultMaps>
  <parameterMaps>
    <parameterMap id="MyOrderManage" class="Hashtable">

      <parameter property="startDate" />
      <parameter property="endDate" />
      <parameter property="tel"/>
      <parameter property="orderNo"/>
      <parameter property="remark"/>
      <parameter property="dy"/>
      <parameter property="dy1"/>

    </parameterMap>
  </parameterMaps>
  <statements>
    
    <select id="SelectStatus" parameterClass="HashTable" resultClass="SeatManage">
      SELECT ID AS Id,Number AS Number,HelpRememberCode AS HelpRememberCode,AreaCode AS AreaCode,SeatCount AS SeatCount,PrivateRoomCode AS PrivateRoomCode,IsAcceptOrder AS IsAcceptOrder,Status AS Status,FloorNumber AS FloorNumber,SeatTypeCode AS SeatTypeCode,MinConsumeMoney AS MinConsumeMoney,IsValidate AS IsValidate,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM SeatManage
      <dynamic prepend=" where ">
        <isNotEmpty prepend="and" property="endDate">
          SeatCount=#endDate#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="tel">
          AreaCode = #tel#
        </isNotEmpty>
        
      </dynamic>
    </select>
    <select id="ISExitsSelectSeatManage" parameterClass="Hashtable" resultClass="SeatManage">
		SELECT ID AS Id,Number AS Number,HelpRememberCode AS HelpRememberCode,AreaCode AS AreaCode,SeatCount AS SeatCount,PrivateRoomCode AS PrivateRoomCode,
		IsAcceptOrder AS IsAcceptOrder,Status AS Status,FloorNumber AS FloorNumber,SeatTypeCode AS SeatTypeCode,MinConsumeMoney AS MinConsumeMoney,IsValidate AS IsValidate,
		CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
		FROM SeatManage
		<dynamic prepend=" WHERE ">
			<isNotEmpty prepend="and" property="privateRoomCode">
				PrivateRoomCode= #privateRoomCode#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="seatTypeCode">
				SeatTypeCode= #seatTypeCode#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="areaCode">
				AreaCode= #areaCode#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="seatCount">
				SeatCount= #seatCount#
			</isNotEmpty>
		</dynamic>
    </select>
	  <select id="SelectSeatManage" parameterClass="string" resultClass="SeatManage">
		  SELECT ID AS Id,Number AS Number,HelpRememberCode AS HelpRememberCode,AreaCode AS AreaCode,SeatCount AS SeatCount,PrivateRoomCode AS PrivateRoomCode,IsAcceptOrder AS IsAcceptOrder,Status AS Status,FloorNumber AS FloorNumber,SeatTypeCode AS SeatTypeCode,MinConsumeMoney AS MinConsumeMoney,IsValidate AS IsValidate,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
		  FROM SeatManage
		 <dynamic prepend="WHERE">
		  <isParameterPresent>
			  HelpRememberCode like '%$value$%' or Number like '%$value$%'
		  </isParameterPresent>
	  </dynamic>
	  </select>
	  <select id="SeatDataCount" parameterClass="int">
		  select count(0) from SeatManage
		  <dynamic prepend="WHERE">
			  <isParameterPresent>
				  HelpRememberCode like '%$value$%' or Number like '%$value$%'
			  </isParameterPresent>
		  </dynamic>
	  </select>
    <select id="SelectSeatManage2" parameterClass="string" resultClass="SeatManage">
      SELECT ID AS Id,Number AS Number,HelpRememberCode AS HelpRememberCode,AreaCode AS AreaCode,SeatCount AS SeatCount,PrivateRoomCode AS PrivateRoomCode,IsAcceptOrder AS IsAcceptOrder,Status AS Status,FloorNumber AS FloorNumber,SeatTypeCode AS SeatTypeCode,MinConsumeMoney AS MinConsumeMoney,IsValidate AS IsValidate,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM SeatManage where AreaCode=#value#
    </select>
    <select id="SeatDataCount2" parameterClass="int">
      select count(0) from SeatManage
    </select>
    <insert id="InsertSeatManage" parameterClass="SeatManage">
      INSERT INTO SeatManage
      (Number,HelpRememberCode,AreaCode,SeatCount,PrivateRoomCode,IsAcceptOrder,Status,FloorNumber,SeatTypeCode,MinConsumeMoney,IsValidate,CreateUser,CreateTime,UpdUser,UpdTime)
      VALUES(#Number#,#HelpRememberCode#,#AreaCode#,#SeatCount#,#PrivateRoomCode#,#IsAcceptOrder#,#Status#,#FloorNumber#,#SeatTypeCode#,#MinConsumeMoney#,#IsValidate#,#CreateUser#,#CreateTime#,#UpdUser#,#UpdTime#)
      <selectKey resultClass="long" type="post" property="Id">
        SELECT LAST_INSERT_ROWID() as value
      </selectKey>
    </insert>
    <update id="UpdateSeatManage" parameterClass="SeatManage">
      UPDATE SeatManage
      SET Number=#Number#,HelpRememberCode=#HelpRememberCode#,AreaCode=#AreaCode#,SeatCount=#SeatCount#,PrivateRoomCode=#PrivateRoomCode#,IsAcceptOrder=#IsAcceptOrder#,Status=#Status#,FloorNumber=#FloorNumber#,SeatTypeCode=#SeatTypeCode#,MinConsumeMoney=#MinConsumeMoney#,IsValidate=#IsValidate#,CreateUser=#CreateUser#,CreateTime=#CreateTime#,UpdUser=#UpdUser#,UpdTime=#UpdTime#
      WHERE ID = #Id#
    </update>
    <update id="UpdateSeatManage2" parameterClass="SeatManage">
      UPDATE SeatManage
      SET Status=#Status#
      WHERE ID = #Id#
    </update>
    <update id="UpdateSeatManage3" parameterClass="SeatManage">
      UPDATE SeatManage
      SET Status=#Status#
      WHERE Number = #Number#
    </update>
    <delete id="DeleteSeatManage" parameterClass="string">
      DELETE FROM SeatManage
      WHERE ID = #value#
    </delete>
    <select id="DataCountForSeat" parameterClass="string">
      select count(0) from SeatManage where AreaCode=#value#
    </select>
    <select id="SelectCountForSeat" parameterClass="HashTable">
      select count(0) from SeatManage 
      <dynamic prepend=" where ">
        <isNotEmpty prepend="and" property="tel">
          AreaCode=#tel#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="endDate">
          SeatCount = #endDate#
        </isNotEmpty>

      </dynamic>
    </select>
    <select id="SeatCountTime" parameterClass="HashTable">
      select count(0) from SeatManage inner join OrderManage on SeatManage.SeatCount=OrderManage.SeatNumber 
      <dynamic prepend=" where ">
        <isNotEmpty prepend="and" property="area">
          SeatManage.AreaCode=#area#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="time">
          OrderManage.OrderDate = #time#
        </isNotEmpty>
        
      </dynamic>
    </select>
  </statements>
</sqlMap>
