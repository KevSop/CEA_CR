<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="DiscountMasterMap"   xmlns="http://ibatis.apache.org/mapping"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
  <alias>
    <typeAlias alias="DiscountMaster" assembly="DataAccess.dll" type="DataAccess.Domain.DiscountMaster" />
  </alias>
  <resultMaps>
    <resultMap id="DiscountMasterResult" class="DiscountMaster">
      <result property="Id" column="ID" type="long" dbType="long"/>
      <result property="DiscountNo" column="DiscountNo" type="string" dbType="varchar"/>
      <result property="DiscountName" column="DiscountName" type="string" dbType="varchar"/>
      <result property="StartTime" column="StartTime" type="DateTime" dbType="DateTime"/>
      <result property="EndTime" column="EndTime" type="DateTime" dbType="DateTime"/>
      <result property="BigType" column="BigType" type="string" dbType="varchar"/>
      <result property="MiddleType" column="MiddleType" type="string" dbType="varchar"/>
      <result property="SmallType" column="SmallType" type="string" dbType="varchar"/>
      <result property="MenuCode" column="MenuCode" type="string" dbType="varchar"/>
      <result property="MarketCode" column="MarketCode" type="string" dbType="varchar"/>
      <result property="DiscountDay" column="DiscountDay" type="string" dbType="varchar"/>
      <result property="Condition" column="Condition" type="string" dbType="varchar"/>
      <result property="Style" column="Style" type="string" dbType="varchar"/>
      <result property="CreateUser" column="CreateUser" type="string" dbType="varchar"/>
      <result property="CreateTime" column="CreateTime" type="DateTime" dbType="DateTime"/>
      <result property="UpdUser" column="UpdUser" type="string" dbType="varchar"/>
      <result property="UpdTime" column="UpdTime" type="DateTime" dbType="DateTime"/>
      <result property="IsDelete" column="IsDelete" type="long" dbType="long"/>
    </resultMap>
  </resultMaps>
  <statements>

    <select id="SelectDiscountMasterList" parameterClass="string" resultClass="DiscountMaster">
      select ID as Id,DiscountNo,DiscountName,StartTime,EndTime,
      ifnull((select Text from FieldValue where KEY='BigType' AND Value=DiscountMaster.BigType),'全部')BigType,
      ifnull((select Text from FieldValue where KEY='MiddleType' AND Value=DiscountMaster.MiddleType),'全部')MiddleType,
      ifnull((select Text from FieldValue where KEY='SmallType' AND Value=DiscountMaster.SmallType),'全部')SmallType,(CASE WHEN MenuCode=0 then '全部' ELSE MenuCode END)MenuCode
      ,DiscountDay,
      (select MarketName from MarketManage where MarketNo=DiscountMaster.MarketCode)MarketCode,
      (select Text from FieldValue where KEY='DiscountCondition' AND Value=DiscountMaster.Condition)Condition,
      (select Text from FieldValue where KEY='DiscountStyle' AND Value=DiscountMaster.Style)Style,CreateUser,
      CreateTime,UpdUser,UpdTime,IsDelete
      from DiscountMaster
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <select id="SelectDiscountMasterDataCount" parameterClass="int">
      select count(0) from DiscountMaster
    </select>
    
    <select id="SelectDiscountMasterItmes" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT '1' CreateUser, a.DiscountNo DiscountNo, (select Text from FieldValue where KEY='BigType' AND Value=b.BigType) as BigType,
      (select Text from FieldValue where KEY='MiddleType' AND Value=b.MiddleType) as MiddleType ,
      (select Text from FieldValue where KEY='SmallType' AND Value=b.SmallType) as SmallType,b.MenuNo  MenuCode,a.Condition Condition,a.Style Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType and a.MiddleType=b.MiddleType and a.SmallType=b.SmallType and a.IsDelete=0 AND a.MenuCode=b.MenuNo
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>

      union
      SELECT '2' CreateUser, a.DiscountNo DiscountNo, (select Text from FieldValue where KEY='BigType' AND Value=b.BigType) as BigType,
      (select Text from FieldValue where KEY='MiddleType' AND Value=b.MiddleType) as MiddleType ,
      (select Text from FieldValue where KEY='SmallType' AND Value=b.SmallType) as SmallType,b.MenuNo  MenuCode,a.Condition Condition,a.Style Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType and a.MiddleType=b.MiddleType and a.SmallType=b.SmallType and a.IsDelete=0 and a.MenuCode=0
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>

      union
      SELECT '3' CreateUser, a.DiscountNo DiscountNo,(select Text from FieldValue where KEY='BigType' AND Value=b.BigType) as BigType,
      (select Text from FieldValue where KEY='MiddleType' AND Value=b.MiddleType) as MiddleType ,
      (select Text from FieldValue where KEY='SmallType' AND Value=b.SmallType) as SmallType,b.MenuNo  MenuCode,a.Condition Condition,a.Style Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType and a.MiddleType=b.MiddleType  and a.IsDelete=0 and a.SmallType=0 and a.MenuCode=0
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>

      union
      SELECT '4' CreateUser, a.DiscountNo DiscountNo,(select Text from FieldValue where KEY='BigType' AND Value=b.BigType) as BigType,
      (select Text from FieldValue where KEY='MiddleType' AND Value=b.MiddleType) as MiddleType ,
      (select Text from FieldValue where KEY='SmallType' AND Value=b.SmallType) as SmallType,b.MenuNo  MenuCode,a.Condition Condition,a.Style Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType  and a.IsDelete=0   and a.MenuCode=0 and a.MiddleType=0 and a.SmallType=0
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>     
      
    </select>

    <select id="SelectDiscountMasterSType" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType and a.MiddleType=b.MiddleType and a.SmallType=b.SmallType and a.IsDelete=0
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>
    </select>

   
    <select id="SelectDiscountMasterMType" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType and a.MiddleType=b.MiddleType  and a.IsDelete=0
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>
    </select>


    <select id="SelectDiscountMasterBType" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a , MenuManage b
      where
      a.BigType=b.BigType  and a.IsDelete=0
      <isNotEmpty prepend="and" property="MeunC">
        MenuNo in ($MeunC$)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>
    </select>

    <select id="SelectDiscountMasterCType" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a where a.IsDelete=0
      <isNotEmpty prepend="and" property="BigType">
        a.BigType =#BigType#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Meunmack">
        MarketCode= #Meunmack#
      </isNotEmpty>
    </select>

    <select id="SelectDiscountMasterCCType" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a
      where  a.IsDelete=0

      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="SmallType">
        a.SmallType= #SType#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Market">
        MarketCode= #Market#
      </isNotEmpty>

    </select>
  
    <select id="SelectDiscountMasterMCType" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a
      where
      a.IsDelete=0

      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MiddleType">
        a.MiddleType= #MiddleType#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Market">
        MarketCode= #Market#
      </isNotEmpty>

    </select>
   
    <select id="SelectDiscountMasterTypeCode" parameterClass="Hashtable" resultClass="DiscountMaster">
      SELECT a.DiscountNo,a.BigType,a.MiddleType,a.SmallType,a.MenuCode,a.Condition,a.Style from  DiscountMaster a
      where
      a.IsDelete=0
      <isNotEmpty prepend="and" property="XTime">
        <![CDATA[ StartTime <= #XTime# ]]>
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ETime">
        EndTime>=#ETime#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MenuTeek">
        DiscountDay like '%$MenuTeek$%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="MeunCode">
        MenuCode= #MeunCode#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="Market">
        MarketCode= #Market#
      </isNotEmpty>
    </select>


    <select id="SelectDiscountMaster" parameterClass="string" resultClass="DiscountMaster">
      SELECT ID AS Id,DiscountNo AS DiscountNo,DiscountName AS DiscountName,StartTime AS StartTime,EndTime AS EndTime,BigType AS BigType,MiddleType AS MiddleType,SmallType AS SmallType,MenuCode AS MenuCode,MarketCode AS MarketCode,DiscountDay AS DiscountDay,Condition AS Condition,Style AS Style,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime,IsDelete AS IsDelete
      FROM DiscountMaster
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>

    <!--parameterClass="Hashtable"  resultClass="DiscountMaster"-->

    <select id="SelectDiscountMasterInfo" parameterClass="Hashtable" resultClass="Hashtable" >
      SELECT ID AS Id,DiscountNo AS DiscountNo,DiscountName AS DiscountName,StartTime AS StartTime,EndTime AS EndTime,BigType AS BigType,MiddleType AS MiddleType,SmallType AS SmallType,MenuCode AS MenuCode,MarketCode AS MarketCode,DiscountDay AS DiscountDay,Condition AS Condition,Style AS Style,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime,IsDelete AS IsDelete
      FROM DiscountMaster
      <dynamic prepend=" WHERE ">
        <isNotEmpty prepend="and" property="XTime">
          StartTime >= #XTime#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="ETime">
          <![CDATA[ EndTime <= #ETime# ]]>
        </isNotEmpty>
        <isNotEmpty prepend="and" property="BType">
          BigType= #BType#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="MType">
          MiddleType= #MType#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="SType">
          SmallType= #SType#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="code">
          MenuCode= #code#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="Market">
          MarketCode= #Market#
        </isNotEmpty>
      </dynamic>
    </select>

    <insert id="InsertDiscountMaster" parameterClass="DiscountMaster">
      INSERT INTO DiscountMaster
      (DiscountNo,DiscountName,StartTime,EndTime,BigType,MiddleType,SmallType,MenuCode,MarketCode,DiscountDay,Condition,Style,CreateUser,CreateTime,UpdUser,UpdTime,IsDelete)
      VALUES(#DiscountNo#,#DiscountName#,#StartTime#,#EndTime#,#BigType#,#MiddleType#,#SmallType#,#MenuCode#,#MarketCode#,#DiscountDay#,#Condition#,#Style#,#CreateUser#,#CreateTime#,#UpdUser#,#UpdTime#,#IsDelete#)
      <selectKey resultClass="long" type="post" property="Id">
        SELECT LAST_INSERT_ROWID() as value
      </selectKey>
    </insert>
    <update id="UpdateDiscountMaster" parameterClass="DiscountMaster">
      UPDATE DiscountMaster
      SET DiscountNo=#DiscountNo#,DiscountName=#DiscountName#,StartTime=#StartTime#,EndTime=#EndTime#,BigType=#BigType#,MiddleType=#MiddleType#,SmallType=#SmallType#,MenuCode=#MenuCode#,MarketCode=#MarketCode#,DiscountDay=#DiscountDay#,Condition=#Condition#,Style=#Style#,CreateUser=#CreateUser#,CreateTime=#CreateTime#,UpdUser=#UpdUser#,UpdTime=#UpdTime#,IsDelete=#IsDelete#
      WHERE ID = #Id#
    </update>
    <delete id="DeleteDiscountMaster" parameterClass="string">
      DELETE FROM DiscountMaster
      WHERE ID = #value#
    </delete>
  </statements>


</sqlMap>
