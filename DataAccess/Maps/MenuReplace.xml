<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="MenuReplaceMap"   xmlns="http://ibatis.apache.org/mapping"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
  <alias>
    <typeAlias alias="MenuReplace" assembly="DataAccess.dll" type="DataAccess.Domain.MenuReplace" />
    <typeAlias alias="V_MenuReplace" assembly="DataAccess.Models.dll" type="DataAccess.Models.V_MenuReplace" />

  </alias>
  <resultMaps>
    <resultMap id="MenuReplaceResult" class="MenuReplace">
      <result property="Id" column="ID" type="long" dbType="long"/>
      <result property="DetailNo" column="DetailNo" type="string" dbType="varchar"/>
      <result property="ReplaceNo" column="ReplaceNo" type="string" dbType="varchar"/>
      <result property="MenuCount" column="MenuCount" type="long" dbType="long"/>
      <result property="CreateUser" column="CreateUser" type="string" dbType="varchar"/>
      <result property="CreateTime" column="CreateTime" type="DateTime" dbType="DateTime"/>
      <result property="UpdUser" column="UpdUser" type="string" dbType="varchar"/>
      <result property="UpdTime" column="UpdTime" type="DateTime" dbType="DateTime"/>
    </resultMap>
  </resultMaps>

  <resultMaps>
    <resultMap id="MenuReplaceResult1" class="V_MenuReplace">
      <result property="MDetailNo" column="MDetailNo" type="string" dbType="varchar"/>
      <result property="ReplaceNo" column="ReplaceNo" type="string" dbType="varchar"/>
      <result property="MenuName" column="MenuName" type="long" dbType="long"/>
      <result property="SalePrice" column="SalePrice" type="single" dbType="Real"/>
    </resultMap>
  </resultMaps>
  <statements>

    <select id="SelectMenuReplace" parameterClass="string" resultClass="MenuReplace">
      SELECT ID AS Id,DetailNo AS DetailNo,ReplaceNo AS ReplaceNo,MenuCount AS MenuCount,CreateUser AS CreateUser,CreateTime AS CreateTime,UpdUser AS UpdUser,UpdTime AS UpdTime
      FROM MenuReplace
      <dynamic prepend="WHERE">
        <isParameterPresent>
          ID = #value#
        </isParameterPresent>
      </dynamic>
    </select>
    <insert id="InsertMenuReplace" parameterClass="MenuReplace">
      INSERT INTO MenuReplace
      (DetailNo,ReplaceNo,MenuCount,CreateUser,CreateTime,UpdUser,UpdTime)
      VALUES(#DetailNo#,#ReplaceNo#,#MenuCount#,#CreateUser#,#CreateTime#,#UpdUser#,#UpdTime#)
      <selectKey resultClass="long" type="post" property="Id">
        SELECT LAST_INSERT_ROWID() as value
      </selectKey>
    </insert>
    <update id="UpdateMenuReplace" parameterClass="MenuReplace">
      UPDATE MenuReplace
      SET DetailNo=#DetailNo#,ReplaceNo=#ReplaceNo#,MenuCount=#MenuCount#,CreateUser=#CreateUser#,CreateTime=#CreateTime#,UpdUser=#UpdUser#,UpdTime=#UpdTime#
      WHERE ID = #Id#
    </update>
    <delete id="DeleteMenuReplace" parameterClass="string">
      DELETE FROM MenuReplace
      WHERE ID = #value#
    </delete>

    <delete id="DeleteMenuReplace1" parameterClass="string">
      DELETE FROM MenuReplace
      WHERE DetailNo = #value#
    </delete>

    <select id="SelectMenuReplace2" parameterClass="string" resultClass="Hashtable">
      SELECT c.ID AS Id,c.DetailNo AS DetailNo,PackageNo AS PackageNo,b.MenuName as MenuName,b.SalePrice as SalePrice,
      c.ReplaceNo AS MenuNo,c.MenuCount AS MenuCount,c.CreateUser AS CreateUser,(select Text from FieldValue where KEY='SaleUnit' AND Value=b.SaleUnit)
      as SaleUnit,      a.CreateTime AS CreateTime,a.UpdUser AS UpdUser,a.UpdTime AS UpdTime
      FROM      MenuReplace c inner join PackageDetail a on c.DetailNo=a.DetailNo
      inner join MenuManage b on c.ReplaceNo=b.MenuNo
      <dynamic prepend="WHERE">
        <isParameterPresent>
          c.DetailNo = #value#
        </isParameterPresent>
      </dynamic>
    </select>

    <select id="SelectMenuReplace3" parameterClass="string" resultClass="V_MenuReplace">
      SELECT a.DetailNo,a.PackageNo,b.ReplaceNo,b.DetailNo,c.MenuName as MenuName ,c.SalePrice as SalePrice from PackageDetail a
      inner join   MenuReplace b on a.DetailNo=b.DetailNo
      INNER JOIN   MenuManage c on b.ReplaceNo = c.MenuNo

        <dynamic prepend=" WHERE ">
          <isNotEmpty prepend="and" property="UID">
            a.PackageNo= #UID#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="DepNo">
            a.DetailNo= #DepNo#
          </isNotEmpty>
        </dynamic>
    </select>


  </statements>
</sqlMap>
